<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>SDG6 æ‹¼åœ–æŒ‘æˆ° (4x4)</title>
  <style>
    body {
      background-color: #e0f7fa;
      text-align: center;
      font-family: Arial;
    }
    h1 {
      color: #00796b;
    }
    #puzzle {
      width: 400px;
      height: 400px;
      margin: auto;
      display: flex;
      flex-wrap: wrap;
      border: 4px solid #00796b;
    }
    .tile {
      width: 100px;
      height: 100px;
      box-sizing: border-box;
      border: 1px solid #004d40;
      background-size: 400px 400px;
      cursor: pointer;
    }
    #timer {
      font-size: 20px;
      color: #d32f2f;
      margin: 10px;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #00796b;
      color: white;
      border: none;
      cursor: pointer;
    }
    #nextButton {
      display: none;
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #ff9800;
      color: white;
      border: none;
      cursor: pointer;
    }
    #musicToggle {
      position: fixed;
      top: 20px;
      left: 20px;
      background-color: #3f51b5;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>SDG6 æ‹¼åœ–æŒ‘æˆ° - 4x4</h1>
<p>ä½ æœ‰ <strong>60 ç§’</strong> å®Œæˆæ‹¼åœ–ï¼Œé»æ“Šå…©å¡Šäº¤æ›ä½ç½®ï¼</p>
<div id="timer">å‰©é¤˜æ™‚é–“ï¼š60 ç§’</div>
<div id="puzzle"></div>
<button onclick="restartGame()">é‡æ–°é–‹å§‹</button>
<button id="nextButton" onclick="location.href='game5.html'">ä¸‹ä¸€é—œ</button>

<!-- èƒŒæ™¯éŸ³æ¨‚ -->
<audio id="backgroundMusic" src="music1.mp3" preload="auto" loop></audio>
<button id="musicToggle">ğŸ”Š éŸ³æ¨‚é–‹</button>

<script>
  const puzzle = document.getElementById("puzzle");
  const timerEl = document.getElementById("timer");
  const imgUrl = "images/bg.jpg"; // å¯æ› SDG6 åœ–

  const SIZE = 4; // 4x4 æ‹¼åœ–
  let tiles = [];
  let firstTile = null;
  let timer;
  let timeLeft = 60;

  const backgroundMusic = document.getElementById('backgroundMusic');
  const musicToggleBtn = document.getElementById('musicToggle');

  // å˜—è©¦å¼·åˆ¶æ’­æ”¾éŸ³æ¨‚
  window.addEventListener("load", () => {
    const playPromise = backgroundMusic.play();
    if (playPromise !== undefined) {
      playPromise.catch((error) => {
        console.warn("ç€è¦½å™¨å¯èƒ½é˜»æ­¢äº†è‡ªå‹•æ’­æ”¾:", error);
      });
    }
  });

  // éŸ³æ¨‚é–‹é—œæŒ‰éˆ•é‚è¼¯
  musicToggleBtn.addEventListener("click", () => {
    if (backgroundMusic.paused) {
      backgroundMusic.play();
      musicToggleBtn.textContent = "ğŸ”Š éŸ³æ¨‚é–‹";
    } else {
      backgroundMusic.pause();
      musicToggleBtn.textContent = "ğŸ”‡ éŸ³æ¨‚é—œ";
    }
  });

  function createPuzzle() {
    clearInterval(timer);
    timeLeft = 60;
    updateTimer();
    puzzle.innerHTML = "";
    tiles = [];

    for (let i = 0; i < SIZE * SIZE; i++) {
      const tile = document.createElement("div");
      tile.className = "tile";
      tile.style.backgroundImage = `url(${imgUrl})`;
      const x = (i % SIZE) * -100;
      const y = Math.floor(i / SIZE) * -100;
      tile.style.backgroundPosition = `${x}px ${y}px`;
      tile.dataset.index = i;
      tile.addEventListener("click", () => swapTile(tile));
      tiles.push(tile);
      puzzle.appendChild(tile);
    }

    setTimeout(() => {
      shuffleTiles();
      startTimer();
    }, 200); // é˜²æ­¢ç•«é¢æœªåˆå§‹åŒ–å®Œæˆå‰å°±é–‹å§‹æ´—ç‰Œ
  }

  function shuffleTiles() {
    for (let i = tiles.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [tiles[i].style.backgroundPosition, tiles[j].style.backgroundPosition] =
        [tiles[j].style.backgroundPosition, tiles[i].style.backgroundPosition];
    }
  }

  function swapTile(tile) {
    if (!firstTile) {
      firstTile = tile;
      tile.style.border = "3px solid red";
    } else {
      const temp = tile.style.backgroundPosition;
      tile.style.backgroundPosition = firstTile.style.backgroundPosition;
      firstTile.style.backgroundPosition = temp;
      firstTile.style.border = "1px solid #004d40";
      firstTile = null;
      checkWin();
    }
  }

  function checkWin() {
    let win = true;
    for (let i = 0; i < tiles.length; i++) {
      const correctPos = `${(i % SIZE) * -100}px ${Math.floor(i / SIZE) * -100}px`;
      if (tiles[i].style.backgroundPosition !== correctPos) {
        win = false;
        break;
      }
    }
    if (win) {
      clearInterval(timer);
      setTimeout(() => {
        alert("ğŸ‰ æ­å–œå®Œæˆæ‹¼åœ–ï¼ä½ æˆåŠŸå®ˆè­·æ°´è³‡æºï¼");
        document.getElementById("nextButton").style.display = "inline-block"; // é¡¯ç¤ºã€Œä¸‹ä¸€é—œã€æŒ‰éˆ•
      }, 100);
    }
  }

  function startTimer() {
    timer = setInterval(() => {
      timeLeft--;
      updateTimer();
      if (timeLeft <= 0) {
        clearInterval(timer);
        alert("â° æ™‚é–“åˆ°äº†ï¼è«‹å†è©¦ä¸€æ¬¡ã€‚");
      }
    }, 1000);
  }

  function updateTimer() {
    timerEl.textContent = `å‰©é¤˜æ™‚é–“ï¼š${timeLeft} ç§’`;
  }

  function restartGame() {
    createPuzzle();
  }

  createPuzzle();
</script>

</body>
</html>
